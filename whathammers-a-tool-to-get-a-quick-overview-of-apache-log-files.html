<!DOCTYPE html>
<html lang="en">
<head>
    <title>Alice/Development Notes &mdash; whathammers: a tool to get a quick overview of Apache log files</title>
    <meta charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="https://aliceh75.github.io/theme/css/style.css"/>
</head>

<body>
    <div id="container">
        <div id="header">
                <div id="site-title"><a href="https://aliceh75.github.io">Alice/Development Notes</a></div>
        </div>

        <div id="contents">
    <div class="post">
        <div class="entry-meta">
            <div class="date">Fri 05 May 2017</div>
            <div class="author">By Alice Heaton</div>
                <div class="tag-list">
                        <a href="https://aliceh75.github.io/tag/apache" rel="tag">#apache</a>
                </div>
        </div>
        <div class="entry-main">
            <h1 class="entry-title">
                <a href="https://aliceh75.github.io/whathammers-a-tool-to-get-a-quick-overview-of-apache-log-files" title="whathammers: a tool to get a quick overview of Apache log files"
                   rel="bookmark">whathammers: a tool to get a quick overview of Apache log files</a>
            </h1>
            <div class="entry-content">
                  <p>With most websites now using some form of client side analytics, we do not tend to parse and analyse Apache log files automatically any more. However for people managing web-servers they are still our first port of call when troubleshooting issues. To help quickly working out what is happening I wrote a small command line tool to parse and provide statistics out of Apache log files.</p>
<p>The tool, inspired by <a href="http://www.exim.org/exim-html-current/doc/html/spec_html/ch-exim_utilities.html#SECTmailstat">eximstats</a>, is called <a href="https://gitlab.com/aliceh75/whathammers"><strong>whathammers</strong></a>. It can parse any Apache log file - the log format is configurable, using the same syntax as the <a href="https://httpd.apache.org/docs/2.2/mod/mod_log_config.html#formats">Apache LogFormat</a> directive, so you can just copy the format from your Apache configuration.</p>
<p>The reports output by the tool can also be configured - though the defaults are sensible. The general idea is that, for any field available in the log file, you can output the <em>n</em> top values by number of hits or, if your log format includes the time for each request, by total time. Here is an example output, based on a real log file (but with IPs and URLs changed) using an extended log format, that shows the default reports. Note that the first thing output is the list of fields available in the log file:</p>
<div class="highlight"><pre><span></span><span class="nv">Parsing</span> <span class="nv">files</span>....
<span class="nv">Logged</span> <span class="nv">fields</span> : <span class="nv">conn_status</span>, <span class="nv">remote_host</span>, <span class="nv">remote_logname</span>, <span class="nv">remote_user</span>, <span class="nv">request_first_line</span>, <span class="nv">request_header_referer</span>, <span class="nv">request_header_user_a</span>
<span class="nv">gent</span>, <span class="nv">request_header_user_agent__browser__family</span>, <span class="nv">request_header_user_agent__browser__version_string</span>, <span class="nv">request_header_user_agent__is_mobi</span>
<span class="nv">le</span>, <span class="nv">request_header_user_agent__os__family</span>, <span class="nv">request_header_user_agent__os__version_string</span>, <span class="nv">request_header_x_forwarded_for</span>, <span class="nv">request_http_v</span>
<span class="nv">er</span>, <span class="nv">request_method</span>, <span class="nv">request_url</span>, <span class="nv">request_url_fragment</span>, <span class="nv">request_url_hostname</span>, <span class="nv">request_url_netloc</span>, <span class="nv">request_url_password</span>, <span class="nv">request_url_path</span>,
 <span class="nv">request_url_port</span>, <span class="nv">request_url_query</span>, <span class="nv">request_url_query_dict</span>, <span class="nv">request_url_query_list</span>, <span class="nv">request_url_query_simple_dict</span>, <span class="nv">request_url_scheme</span>,
 <span class="nv">request_url_username</span>, <span class="nv">response_bytes_clf</span>, <span class="nv">server_name</span>, <span class="nv">status</span>, <span class="nv">time_received</span>, <span class="nv">time_received_datetimeobj</span>, <span class="nv">time_received_isoformat</span>, <span class="nv">time_</span>
<span class="nv">received_tz_datetimeobj</span>, <span class="nv">time_received_tz_isoformat</span>, <span class="nv">time_received_utc_datetimeobj</span>, <span class="nv">time_received_utc_isoformat</span>, <span class="nv">time_us</span>

<span class="nv">Top</span> <span class="mi">5</span> <span class="nv">remote</span> <span class="nv">host</span> <span class="nv">by</span> <span class="nv">hits</span>
<span class="o">-------------------------</span>
           <span class="mi">33</span>.<span class="mi">33</span>.<span class="mi">33</span>.<span class="mi">33</span>: <span class="mi">18496</span> <span class="nv">hits</span> <span class="ss">(</span><span class="mi">17</span>.<span class="mi">04</span><span class="o">%</span> <span class="nv">of</span> <span class="nv">total</span><span class="ss">)</span>
        <span class="mi">33</span>.<span class="mi">333</span>.<span class="mi">333</span>.<span class="mi">333</span>: <span class="mi">5090</span> <span class="nv">hits</span> <span class="ss">(</span><span class="mi">4</span>.<span class="mi">69</span><span class="o">%</span> <span class="nv">of</span> <span class="nv">total</span><span class="ss">)</span>
     <span class="nv">bla</span>.<span class="nv">somewhere</span>.<span class="nv">com</span>: <span class="mi">3920</span> <span class="nv">hits</span> <span class="ss">(</span><span class="mi">3</span>.<span class="mi">61</span><span class="o">%</span> <span class="nv">of</span> <span class="nv">total</span><span class="ss">)</span>
         <span class="mi">333</span>.<span class="mi">333</span>.<span class="mi">33</span>.<span class="mi">33</span>: <span class="mi">3436</span> <span class="nv">hits</span> <span class="ss">(</span><span class="mi">3</span>.<span class="mi">17</span><span class="o">%</span> <span class="nv">of</span> <span class="nv">total</span><span class="ss">)</span>
<span class="nv">and</span>.<span class="nv">somewhere</span>.<span class="k">else</span>.<span class="nv">com</span>: <span class="mi">2567</span> <span class="nv">hits</span> <span class="ss">(</span><span class="mi">2</span>.<span class="mi">36</span><span class="o">%</span> <span class="nv">of</span> <span class="nv">total</span><span class="ss">)</span>

<span class="nv">Top</span> <span class="mi">5</span> <span class="nv">remote</span> <span class="nv">host</span> <span class="nv">by</span> <span class="nv">total</span> <span class="nv">time</span>
<span class="o">-------------------------------</span>
           <span class="mi">33</span>.<span class="mi">33</span>.<span class="mi">33</span>.<span class="mi">33</span>: <span class="mi">30575</span>.<span class="mi">46</span> <span class="nv">seconds</span> <span class="ss">(</span><span class="mi">21</span>.<span class="mi">88</span><span class="o">%</span> <span class="nv">of</span> <span class="nv">total</span><span class="ss">)</span>
     <span class="nv">bla</span>.<span class="nv">somewhere</span>.<span class="nv">com</span>: <span class="mi">4010</span>.<span class="mi">18</span> <span class="nv">seconds</span> <span class="ss">(</span><span class="mi">2</span>.<span class="mi">87</span><span class="o">%</span> <span class="nv">of</span> <span class="nv">total</span><span class="ss">)</span>
        <span class="mi">33</span>.<span class="mi">333</span>.<span class="mi">333</span>.<span class="mi">333</span>: <span class="mi">3932</span>.<span class="mi">08</span> <span class="nv">seconds</span> <span class="ss">(</span><span class="mi">2</span>.<span class="mi">81</span><span class="o">%</span> <span class="nv">of</span> <span class="nv">total</span><span class="ss">)</span>
         <span class="mi">333</span>.<span class="mi">333</span>.<span class="mi">33</span>.<span class="mi">33</span>: <span class="mi">3880</span>.<span class="mi">73</span> <span class="nv">seconds</span> <span class="ss">(</span><span class="mi">2</span>.<span class="mi">78</span><span class="o">%</span> <span class="nv">of</span> <span class="nv">total</span><span class="ss">)</span>
<span class="nv">and</span>.<span class="nv">somewhere</span>.<span class="k">else</span>.<span class="nv">com</span>: <span class="mi">3581</span>.<span class="mi">93</span> <span class="nv">seconds</span> <span class="ss">(</span><span class="mi">2</span>.<span class="mi">56</span><span class="o">%</span> <span class="nv">of</span> <span class="nv">total</span><span class="ss">)</span>

<span class="nv">Top</span> <span class="mi">5</span> <span class="nv">user</span> <span class="nv">agent</span> <span class="nv">by</span> <span class="nv">hits</span>
<span class="o">------------------------</span>
<span class="nv">Mozilla</span><span class="o">/</span><span class="mi">5</span>.<span class="mi">0</span> <span class="ss">(</span><span class="nv">compatible</span><span class="c1">; MJ12bot/v1.4...: 26365 hits (24.29% of total)</span>
<span class="nv">Mozilla</span><span class="o">/</span><span class="mi">4</span>.<span class="mi">0</span> <span class="ss">(</span><span class="nv">compatible</span><span class="c1">; MSIE 9.0; Wi...: 11216 hits (10.33% of total)</span>
<span class="nv">Mozilla</span><span class="o">/</span><span class="mi">5</span>.<span class="mi">0</span> <span class="ss">(</span><span class="nv">Windows</span> <span class="nv">NT</span> <span class="mi">6</span>.<span class="mi">3</span><span class="c1">; Win64; x...: 9522 hits (8.77% of total)</span>
<span class="nv">Mozilla</span><span class="o">/</span><span class="mi">5</span>.<span class="mi">0</span> <span class="ss">(</span><span class="nv">Macintosh</span><span class="c1">; Intel Mac OS ...: 8154 hits (7.51% of total)</span>
<span class="nv">Mozilla</span><span class="o">/</span><span class="mi">5</span>.<span class="mi">0</span> <span class="ss">(</span><span class="nv">compatible</span><span class="c1">; Googlebot/2....: 4596 hits (4.23% of total)</span>

<span class="nv">Top</span> <span class="mi">5</span> <span class="nv">user</span> <span class="nv">agent</span> <span class="nv">by</span> <span class="nv">total</span> <span class="nv">time</span>
<span class="o">------------------------------</span>
<span class="nv">Mozilla</span><span class="o">/</span><span class="mi">5</span>.<span class="mi">0</span> <span class="ss">(</span><span class="nv">compatible</span><span class="c1">; MJ12bot/v1.4...: 38073.62 seconds (27.24% of total)</span>
<span class="nv">Mozilla</span><span class="o">/</span><span class="mi">5</span>.<span class="mi">0</span> <span class="ss">(</span><span class="nv">Macintosh</span><span class="c1">; Intel Mac OS ...: 18340.86 seconds (13.12% of total)</span>
<span class="nv">Mozilla</span><span class="o">/</span><span class="mi">4</span>.<span class="mi">0</span> <span class="ss">(</span><span class="nv">compatible</span><span class="c1">; MSIE 9.0; Wi...: 11810.71 seconds (8.45% of total)</span>
<span class="nv">Mozilla</span><span class="o">/</span><span class="mi">5</span>.<span class="mi">0</span> <span class="ss">(</span><span class="nv">Windows</span> <span class="nv">NT</span> <span class="mi">6</span>.<span class="mi">3</span><span class="c1">; Win64; x...: 11578.16 seconds (8.28% of total)</span>
<span class="nv">Mozilla</span><span class="o">/</span><span class="mi">5</span>.<span class="mi">0</span> <span class="ss">(</span><span class="nv">compatible</span><span class="c1">; Googlebot/2....: 7003.51 seconds (5.01% of total)</span>

<span class="nv">Top</span> <span class="mi">5</span> <span class="nv">request_url_path</span> <span class="nv">by</span> <span class="nv">hits</span>
<span class="o">------------------------------</span>
                <span class="o">/</span><span class="nv">a</span><span class="o">/</span><span class="nv">path</span>: <span class="mi">14397</span> <span class="nv">hits</span> <span class="ss">(</span><span class="mi">13</span>.<span class="mi">26</span><span class="o">%</span> <span class="nv">of</span> <span class="nv">total</span><span class="ss">)</span>
<span class="o">/</span><span class="nv">another</span><span class="o">/</span><span class="nv">path</span><span class="o">/</span><span class="nv">or</span><span class="o">/</span><span class="nv">sorts</span><span class="o">/</span>: <span class="mi">6580</span> <span class="nv">hits</span> <span class="ss">(</span><span class="mi">6</span>.<span class="mi">06</span><span class="o">%</span> <span class="nv">of</span> <span class="nv">total</span><span class="ss">)</span>
                      <span class="o">/</span>: <span class="mi">5942</span> <span class="nv">hits</span> <span class="ss">(</span><span class="mi">5</span>.<span class="mi">47</span><span class="o">%</span> <span class="nv">of</span> <span class="nv">total</span><span class="ss">)</span>
     <span class="o">/</span><span class="nv">paths</span><span class="o">/</span><span class="nv">everywhere</span><span class="o">/</span>: <span class="mi">4133</span> <span class="nv">hits</span> <span class="ss">(</span><span class="mi">3</span>.<span class="mi">81</span><span class="o">%</span> <span class="nv">of</span> <span class="nv">total</span><span class="ss">)</span>
       <span class="o">/</span><span class="nv">the</span><span class="o">/</span><span class="nv">super</span><span class="o">/</span><span class="nv">path</span><span class="o">/</span>: <span class="mi">3597</span> <span class="nv">hits</span> <span class="ss">(</span><span class="mi">3</span>.<span class="mi">31</span><span class="o">%</span> <span class="nv">of</span> <span class="nv">total</span><span class="ss">)</span>

<span class="nv">time_received</span> <span class="nv">by</span> <span class="nv">hits</span>, <span class="mi">5</span> <span class="nv">slices</span>
<span class="o">-------------------------------</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">23</span> <span class="mi">04</span>:<span class="mi">14</span>:<span class="mi">29</span>: <span class="o">----------------</span> <span class="ss">(</span><span class="mi">12483</span> <span class="nv">hits</span><span class="ss">)</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">23</span> <span class="mi">21</span>:<span class="mi">13</span>:<span class="mi">08</span>: <span class="o">-------------------------</span> <span class="ss">(</span><span class="mi">18810</span> <span class="nv">hits</span><span class="ss">)</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">24</span> <span class="mi">14</span>:<span class="mi">11</span>:<span class="mi">47</span>: <span class="o">--------------------------</span> <span class="ss">(</span><span class="mi">19702</span> <span class="nv">hits</span><span class="ss">)</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">25</span> <span class="mi">07</span>:<span class="mi">10</span>:<span class="mi">26</span>: <span class="o">-------------------------------------</span> <span class="ss">(</span><span class="mi">27745</span> <span class="nv">hits</span><span class="ss">)</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">26</span> <span class="mi">00</span>:<span class="mi">09</span>:<span class="mi">05</span>: <span class="o">----------------------------------------</span> <span class="ss">(</span><span class="mi">29814</span> <span class="nv">hits</span><span class="ss">)</span>

<span class="nv">time_received</span> <span class="nv">by</span> <span class="nv">time</span> <span class="nv">per</span> <span class="nv">hit</span>, <span class="mi">5</span> <span class="nv">slices</span>
<span class="o">---------------------------------------</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">23</span> <span class="mi">04</span>:<span class="mi">14</span>:<span class="mi">29</span>: <span class="o">---------------------------------</span> <span class="ss">(</span><span class="mi">1</span>.<span class="mi">43</span> <span class="nv">seconds</span><span class="ss">)</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">23</span> <span class="mi">21</span>:<span class="mi">13</span>:<span class="mi">08</span>: <span class="o">-------------------------------</span> <span class="ss">(</span><span class="mi">1</span>.<span class="mi">30</span> <span class="nv">seconds</span><span class="ss">)</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">24</span> <span class="mi">14</span>:<span class="mi">11</span>:<span class="mi">47</span>: <span class="o">----------------------</span> <span class="ss">(</span><span class="mi">955</span>.<span class="mi">42</span> <span class="nv">miliseconds</span><span class="ss">)</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">25</span> <span class="mi">07</span>:<span class="mi">10</span>:<span class="mi">26</span>: <span class="o">------------------------</span> <span class="ss">(</span><span class="mi">1</span>.<span class="mi">03</span> <span class="nv">seconds</span><span class="ss">)</span>
<span class="mi">2017</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mi">26</span> <span class="mi">00</span>:<span class="mi">09</span>:<span class="mi">05</span>: <span class="o">----------------------------------------</span> <span class="ss">(</span><span class="mi">1</span>.<span class="mi">68</span> <span class="nv">seconds</span><span class="ss">)</span>
</pre></div>


<p>More advanced functionality can easily be achieved by combining our usual set of command line tools - for example you can simply filter out entries before analysis by using <code>grep -v</code>:</p>
<div class="highlight"><pre><span></span><span class="n">cat</span> <span class="k">access</span><span class="p">.</span><span class="n">log</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">v</span> <span class="mi">111</span><span class="p">.</span><span class="mi">111</span><span class="p">.</span><span class="mi">111</span><span class="p">.</span><span class="mi">111</span> <span class="o">|</span> <span class="n">whathammers</span>
</pre></div>


<p><a href="https://gitlab.com/aliceh75/whathammers">Usage instructions and the source code are on Gitlab</a> and <strong>whathammers</strong> is also available as a <a href="https://pypi.python.org/pypi/whathammers">Python package on pypi.python.org</a>.</p>
            </div>
        </div>
    </div>
        </div>

        <div id="footer">
            <p>Alice online: <a href="https://github.com/aliceh75">GitHub</a> <a href="https://gitlab.com/aliceh75">GitLab</a> <a href="https://twitter.com/aliceheaton75">Twitter</a></p>
            <p>Site generated by <a href="https://pelican.readthedocs.org">Pelican</a>, theme loosely based on <a href="https://github.com/tbunnyman/pelican-chunk">Chunk</a></p>
            <p>All content by Alice Heaton, licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
               <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a>
            </p>
        </div>
    </div>
</body>
</html>